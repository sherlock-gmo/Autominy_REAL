#! /usr/bin/env python
import rospy
import time
import numpy as np
from autominy_msgs.msg import SpeedPWMCommand
from autominy_msgs.msg import Speed

speed_msg = SpeedPWMCommand() #-1000 to 1000 pwm
path = '/home/ros/dotMEX_Autominy_REAL/autominy_ws/src/dotmex2022/calibration/motor_bldc/without_charge/'
t0 = time.time()
sp_sensor = 0.0
#*************************************************************************************************************
#*************************************************************************************************************
#*************************************************************************************************************
def speed_cb(data1):
	global sp_sensor
	sp_sensor = data1.value
	sqrt_p()
#*************************************************************************************************************
#*************************************************************************************************************
#*************************************************************************************************************
def sqrt_p():
	t = time.time()
	T = t-t0
	v = 50
	speed_msg.value = v
	Vpub.publish(speed_msg)
	f = open(path+'bldc0_v'+str(v)+'.csv','a+')
	f.write("%5.6f	%5.6f	%5.6f\n" %(T, v, sp_sensor))
	f.close()
#*************************************************************************************************************
#*************************************************************************************************************
#*************************************************************************************************************
#					PRINCIPAL
if __name__ == '__main__':
	print("Nodo inicializado: sp_test_01.py")
	rospy.init_node('sp_test_01',anonymous=True)
	Vpub = rospy.Publisher('/actuators/speed_pwm',SpeedPWMCommand,queue_size=60)
	rospy.Subscriber("/sensors/speed",Speed,speed_cb)
	rospy.spin()
#*************************************************************************************************************
#*************************************************************************************************************
#*************************************************************************************************************
